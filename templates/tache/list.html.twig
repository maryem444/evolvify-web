{% extends 'base.html.twig' %}

{% block title %}Liste des T√¢ches
{% endblock %}

{% block stylesheets %}
	<style>
		.page-header {
			margin-top: 80px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		.page-title {
			margin: 0;
			font-size: 24px;
			color: #034694;
			font-weight: bold;
		}
		.header-buttons {
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.btn-add-tache {
			background: linear-gradient(to right, #4CAF50, #2196F3);
			color: white;
			border: none;
			padding: 8px 16px;
			border-radius: 4px;
			font-size: 14px;
			font-weight: 500;
			text-transform: uppercase;
			display: inline-flex;
			align-items: center;
			gap: 8px;
			text-decoration: none;
			transition: opacity 0.3s ease;
		}
		.btn-add-tache:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
		}
		.btn-add-tache i {
			margin-right: 5px;
		}
		.table thead {
			background-color: rgb(169, 243, 240) !important;
			color: white;
		}
		.btn-group {
			display: flex;
			gap: 10px;
		}
		.btn-group i {
			cursor: pointer;
			transition: color 0.3s ease;
		}
		.btn-group .fa-edit {
			color: #4CAF50;
		}
		.btn-group .fa-trash {
			color: #F44336;
		}
		.btn-group .fa-edit:hover {
			color: #45a049;
		}
		.btn-group .fa-trash:hover {
			color: #d32f2f;
		}

		/* Status Colors */
		.status-to-do {
			background-color: #3498db;
			color: white;
			padding: 8px 14px;
			font-size: 12px;
			border-radius: 5px;
		}
		.status-in-progress {
			background-color: #f39c12;
			color: white;
			padding: 8px 14px;
			font-size: 12px;
			border-radius: 5px;
		}
		.status-done {
			background-color: #2ecc71;
			color: white;
			padding: 8px 14px;
			font-size: 12px;
			border-radius: 5px;
		}
		.status-canceled {
			background-color: #e74c3c;
			color: white;
			padding: 8px 14px;
			font-size: 12px;
			border-radius: 5px;
		}

		/* Priority Colors */
		.priority-low {
			background-color: #2ecc71;
			color: white;
			padding: 8px 14px;
			font-size: 12px;
			border-radius: 5px;
		}
		.priority-medium {
			background-color: #f39c12;
			color: white;
			padding: 8px 14px;
			font-size: 12px;
			border-radius: 5px;
		}
		.priority-high {
			background-color: #e74c3c;
			color: white;
			padding: 8px 14px;
			font-size: 12px;
			border-radius: 5px;
		}

		/* Effet de superposition */
		.overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
			display: none;
			justify-content: center;
			align-items: center;
			z-index: 1050;
			padding: 20px;
			overflow: auto;
		}

		.modal-custom {
			background-color: #fff;
			border-radius: 10px;
			padding: 20px;
			width: 500px;
			max-height: 90vh;
			overflow-y: auto;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
			position: relative;
		}

		.modal-header {
			font-size: 18px;
			font-weight: bold;
			margin-bottom: 20px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.modal-body input,
		.modal-body select {
			width: 100%;
			padding: 10px;
			margin-bottom: 15px;
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		.modal-body .form-icon {
			margin-right: 10px;
		}

		.modal-footer {
			text-align: right;
			display: flex;
			justify-content: flex-end;
			gap: 10px;
			margin-top: 15px;
		}

		.close-btn {
			color: #888;
			font-size: 24px;
			cursor: pointer;
			line-height: 1;
		}

		/* Focus effect */
		.modal-body input:focus,
		.modal-body select:focus {
			border-color: #4CAF50;
			box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
			outline: none;
		}

		/* Responsive adjustments */
		@media(max-width: 480px) {
			.modal-custom {
				width: 95%;
				margin: 0 auto;
			}
		}
		.actions-container {
			margin-top: 20px;
			margin-bottom: 20px;
			text-align: left;
		}

		.btn-return {
			background-color: #034694;
			color: white;
			padding: 8px 16px;
			border-radius: 4px;
			text-decoration: none;
			display: inline-flex;
			align-items: center;
			gap: 8px;
			font-weight: 500;
			transition: background-color 0.3s;
		}

		.btn-return:hover {
			background-color: #023a7a;
			text-decoration: none;
			color: white;
		}

		.btn-return i {
			margin-right: 5px;
		}
	</style>
{% endblock %}

{% block content %}
	<div class="container-fluid">
		<div class="page-header">
			<h1 class="page-title">üìã Liste des T√¢ches pour le Projet
				{{ projet.name }}</h1>
			<div class="header-buttons">
				<button class="btn-add-tache" onclick="openModal()">
					<i class="fas fa-plus"></i>
					Ajouter T√¢che
				</button>
			</div>
		</div>

		<div class="card">
			<div class="card-body">
				<table class="table table-striped table-bordered">
					<thead>
						<tr>
							<th>Description</th>
							<th>Statut</th>
							<th>Date de cr√©ation</th>
							<th>Priorit√©</th>
							<th>Location</th>
							<th>Employ√©</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for tache in taches %}
							<tr>
								<td>{{ tache.description }}</td>
								<td>
									<span class="badge status-{{ tache.status.name|lower|replace({'_': '-'}) }}">
										{{ tache.status.name|replace({'_': ' '})|title }}
									</span>
								</td>
								<td>{{ tache.createdAt ? tache.createdAt|date('d/m/Y') : '-' }}</td>
								<td>
									<span class="badge priority-{{ tache.priority.name|lower }}">
										{{ tache.priority.name|title }}
									</span>
								</td>
								<td>{{ tache.location ?? '-' }}</td>
								<td>{{ tache.idEmploye ?? '-' }}</td>
								<td>
									<div class="btn-group" role="group">
										<a href="#" onclick="openModal({{ tache.idTache }}, '{{ tache.description }}')" title="Modifier">
											<i class="fas fa-edit"></i>
										</a>

										<form action="{{ path('taches_delete', { 'id': projet.id, 'tacheId': tache.idTache }) }}" method="post" onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cette t√¢che ?');" style="display:inline;">
											<button type="submit" style="border: none; background: none; padding: 0;">
												<i class="fas fa-trash" title="Supprimer" style="color: #F44336; cursor: pointer;"></i>
											</button>
										</form>
									</div>
								</td>
							</tr>
						{% else %}
							<tr>
								<td colspan="7" class="text-center">Aucune t√¢che trouv√©e</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
		<div class="actions-container mt-3">
			<a href="{{ path('projets_list') }}" class="btn-return">
				<i class="fas fa-arrow-left"></i>
				Retour √† la liste
			</a>
		</div>
	</div>

	<!-- Modal pour ajouter une t√¢che -->
	<div class="overlay" id="overlay">
		<div class="modal-custom">
			<div class="modal-header">
				<h5>Ajouter une T√¢che</h5>
				<span class="close-btn" onclick="closeModal()">&times;</span>
			</div>
			<div class="modal-body">
				{{ form_start(form, {'action': path('taches_add', {'id': projet.id}), 'method': 'POST'}) }}
				<div class="form-group">
					{{ form_label(form.description) }}
					{{ form_widget(form.description, {'attr': {'class': 'form-control'}}) }}
					{{ form_errors(form.description) }}
				</div>

				<div class="form-group">
					{{ form_label(form.status) }}
					{{ form_widget(form.status, {'attr': {'class': 'form-control'}}) }}
					{{ form_errors(form.status) }}
				</div>

				<div class="form-group">
					{{ form_label(form.priority) }}
					{{ form_widget(form.priority, {'attr': {'class': 'form-control'}}) }}
					{{ form_errors(form.priority) }}
				</div>

				<div class="form-group">
					{{ form_label(form.location) }}
					{{ form_widget(form.location, {'attr': {'class': 'form-control', 'placeholder': 'Lieu de la t√¢che'}}) }}
					{{ form_errors(form.location) }}
				</div>

				<div class="form-group">
					{{ form_label(form.createdAt) }}
					{{ form_widget(form.createdAt, {'attr': {'class': 'form-control'}}) }}
					{{ form_errors(form.createdAt) }}
				</div>

				{{ form_widget(form.idEmploye) }}
				<!-- S√©lection de l'employ√© -->

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" onclick="closeModal()">Annuler</button>
					{{ form_widget(form.submit, {'attr': {'class': 'btn btn-primary'}}) }}
				</div>
				{{ form_end(form) }}
			</div>
		</div>
	</div>

	<script>
		function openModal(tacheId = null, description = '') {
let form = document.querySelector("#overlay form");

if (tacheId) { // Mode √©dition : on modifie l'action du formulaire
form.action = `/projets/{{ projet.id }}/taches/edit/` + tacheId;
document.querySelector("#overlay h5").innerText = "Modifier une T√¢che";
document.querySelector("#tache_description").value = description;
} else { // Mode ajout : r√©initialisation du formulaire
form.action = `/projets/{{ projet.id }}/taches/ajouter`;
document.querySelector("#overlay h5").innerText = "Ajouter une T√¢che";
document.querySelector("#tache_description").value = '';
}

document.getElementById("overlay").style.display = "flex";
}

function closeModal() {
document.getElementById("overlay").style.display = "none";
}
	</script>
{% endblock %}
